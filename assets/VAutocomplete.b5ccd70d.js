import{m as X}from"./VSelect.9399d225.js";import{J as Y,c as x,ap as Z,ai as J,a4 as q,_ as ee,ag as te,al as le,r as P,g as j,w as B,j as i,F as Q,k as O,v as ne,n as R}from"./index.0b3b7628.js";import{m as ae}from"./VImg.4f1b5ef8.js";import{f as ue}from"./forwardRefs.c003b6b8.js";import{u as oe,a as re,V as z}from"./VList.cbcc482f.js";import{m as ie,f as se,V as ce}from"./VTextField.4a627311.js";import{V as fe}from"./VMenu.7c25673f.js";import{V as ve}from"./VCheckboxBtn.ec15e4e8.js";import{h as de,i as me}from"./router.f6657911.js";import{V as pe}from"./VChip.0df7fa6f.js";const he=(e,a,t)=>e==null||a==null?-1:e.toString().toLocaleLowerCase().indexOf(a.toString().toLocaleLowerCase()),ye=Y({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ge(e,a,t){var p,F;const y=[],g=(p=t==null?void 0:t.default)!=null?p:he,v=t!=null&&t.filterKeys?J(t.filterKeys):!1,d=Object.keys((F=t==null?void 0:t.customKeyFilter)!=null?F:{}).length;if(!(e!=null&&e.length))return y;e:for(let C=0;C<e.length;C++){const n=e[C],s={},h={};let c=-1;if(a&&!(t!=null&&t.noFilter)){if(typeof n=="object"){const T=v||Object.keys(n);for(const k of T){var r;const K=q(n,k,n),w=t==null||(r=t.customKeyFilter)==null?void 0:r[k];if(c=w?w(K,a,n):g(K,a,n),c!==-1&&c!==!1)w?s[k]=c:h[k]=c;else if((t==null?void 0:t.filterMode)==="every")continue e}}else c=g(n,a,n),c!==-1&&c!==!1&&(h.title=c);const I=Object.keys(h).length,V=Object.keys(s).length;if(!I&&!V||(t==null?void 0:t.filterMode)==="union"&&V!==d&&!I||(t==null?void 0:t.filterMode)==="intersection"&&(V!==d||!I))continue}y.push({index:C,matches:{...h,...s}})}return y}function Ve(e,a,t){const y=x(()=>typeof(t==null?void 0:t.value)!="string"&&typeof(t==null?void 0:t.value)!="number"?"":String(t.value));return{filteredItems:x(()=>{const v=Z(a);return ge(v,y.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).map(r=>{let{index:p,matches:F}=r;return{item:v[p],matches:F}})})}}function ke(e,a,t){if(Array.isArray(a))throw new Error("Multiple matches is not implemented");return typeof a=="number"&&~a?i(Q,null,[i("span",{class:"v-autocomplete__unmask"},[e.substr(0,a)]),i("span",{class:"v-autocomplete__mask"},[e.substr(a,t)]),i("span",{class:"v-autocomplete__unmask"},[e.substr(a+t)])]):e}const Ae=ee()({name:"VAutocomplete",props:{search:String,...ye({filterKeys:["title"]}),...X(),...te(ie({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...ae({transition:!1})},emits:{"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,a){let{slots:t}=a;const{t:y}=le(),g=P(),v=P(!1),d=P(!0),r=j(e,"menu"),{items:p,transformIn:F,transformOut:C}=oe(e),n=j(e,"search",""),s=j(e,"modelValue",[],l=>F(J(l)),l=>{var o;const u=C(l);return e.multiple?u:(o=u[0])!=null?o:null}),{filteredItems:h}=Ve(e,p,x(()=>d.value?void 0:n.value)),c=x(()=>s.value.map(l=>p.value.find(u=>e.valueComparator(u.value,l.value))||l)),I=x(()=>c.value.map(l=>l.props.value)),V=P();function T(l){s.value=[],e.openOnClear&&(r.value=!0),n.value=""}function k(){e.hideNoData&&!p.value.length||e.readonly||(r.value=!0)}function K(l){if(!e.readonly){if(["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(d.value=!0),l.key==="ArrowDown"){var u;l.preventDefault(),(u=V.value)==null||u.focus("next")}else if(l.key==="ArrowUp"){var o;l.preventDefault(),(o=V.value)==null||o.focus("prev")}}}function w(l){n.value=l.target.value}function $(){v.value&&(d.value=!0)}function G(l){v.value=!0}function H(l){if(l.relatedTarget==null){var u;(u=g.value)==null||u.focus()}}const b=P(!1);function A(l){if(e.multiple){const u=I.value.findIndex(o=>o===l.value);if(u===-1)s.value=[...s.value,l],n.value="";else{const o=[...s.value];o.splice(u,1),s.value=o}}else s.value=[l],b.value=!0,t.selection||(n.value=l.title),r.value=!1,d.value=!0,R(()=>b.value=!1)}return B(v,l=>{var o;if(l){var u;b.value=!0,n.value=e.multiple||!!t.selection?"":String((o=(u=c.value.at(-1))==null?void 0:u.props.title)!=null?o:""),d.value=!0,R(()=>b.value=!1)}else r.value=!1,n.value=""}),B(n,l=>{!v.value||b.value||(l&&(r.value=!0),d.value=!l)}),de(()=>{const l=!!(e.chips||t.chip),[u]=se(e);return i(ce,O({ref:g},u,{modelValue:n.value,"onUpdate:modelValue":o=>{o==null&&(s.value=[])},validationValue:s.externalValue,dirty:s.value.length>0,onInput:w,class:["v-autocomplete",{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!e.chips,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!t.selection}],appendInnerIcon:e.menuIcon,readonly:e.readonly,"onClick:clear":T,"onClick:control":k,"onClick:input":k,onFocus:()=>v.value=!0,onBlur:()=>v.value=!1,onKeydown:K}),{...t,default:()=>{var o,E,N;return i(Q,null,[i(fe,O({modelValue:r.value,"onUpdate:modelValue":f=>r.value=f,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:$},e.menuProps),{default:()=>[i(re,{ref:V,selected:I.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:f=>f.preventDefault(),onFocusin:G,onFocusout:H},{default:()=>{var f;return[!h.value.length&&!e.hideNoData&&((f=(o=t["no-data"])==null?void 0:o.call(t))!=null?f:i(z,{title:y(e.noDataText)},null)),(E=t["prepend-item"])==null?void 0:E.call(t),h.value.map((_,L)=>{var U;var M;let{item:m,matches:W}=_;return(U=(M=t.item)==null?void 0:M.call(t,{item:m,index:L,props:O(m.props,{onClick:()=>A(m)})}))!=null?U:i(z,O({key:L},m.props,{onClick:()=>A(m)}),{prepend:S=>{let{isSelected:D}=S;return e.multiple&&!e.hideSelected?i(ve,{modelValue:D,ripple:!1},null):void 0},title:()=>{var D;var S;return d.value?m.title:ke(m.title,W.title,(D=(S=n.value)==null?void 0:S.length)!=null?D:0)}})}),(N=t["append-item"])==null?void 0:N.call(t)]}})]}),c.value.map((f,_)=>{function L(m){m.stopPropagation(),m.preventDefault(),A(f)}const M={"onClick:close":L,modelValue:!0,"onUpdate:modelValue":void 0};return i("div",{key:f.value,class:"v-autocomplete__selection"},[l?i(me,{defaults:{VChip:{closable:e.closableChips,size:"small",text:f.title}}},{default:()=>[t.chip?t.chip({item:f,index:_,props:M}):i(pe,M,null)]}):t.selection?t.selection({item:f,index:_}):i("span",{class:"v-autocomplete__selection-text"},[f.title,e.multiple&&_<c.value.length-1&&i("span",{class:"v-autocomplete__selection-comma"},[ne(",")])])])})])}})}),ue({isFocused:v,isPristine:d,menu:r,search:n,filteredItems:h,select:A},g)}});export{Ae as V};
